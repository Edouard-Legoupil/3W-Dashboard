<!DOCTYPE html>
<meta charset="utf-8">
<html>

  <head>
    <title>2014 Refugee Response Plan in Jordan</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.1/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/dc.css"/>
    <link rel="stylesheet" type="text/css" href="css/3w-dashboard.css"/>
    <script src="//code.jquery.com/jquery.js"></script>
    <script src="js/data-jo.js"></script>
  <link href="http://www.unhcr.org/favicon.ico" rel="icon" type="image/x-icon">
  </head>
  
  <body>
      
    <div class ="col-sm-4 col-md-offset4" id="loading">
        <h1>Patience: Loading the data... (~a few MB)</h1><small>Does not work on IE8 or older... <a href="https://www.mozilla.org/en-US/firefox/new/"></a>upgrade your browser if needed</a></a></small>
    </div>
    
    <div class="container" id="dashboard">
		<h3>2014 Refugee Response Plan in Jordan</h3>
      <div class="row">
        <div class="col-lg-4">
          <div class="row">
            
            <div class="col-xs-12">Explore <a href="https://www.syrianrefugeeresponse.org" target="_blank" >2014 Interagency Response</a> for Refugee Crisis in Jordan.</div>
            <div id="count-info" class="col-xs-9">
              <span class="filter-count "></span> selected out of <span class="total-count "></span> records
            </div>
            <div class="col-xs-3">
              <a class="reset btn btn-primary btn-sm" id="reset" href="javascript:dc.filterAll();dc.redrawAll();">Reset All</a>
            </div>
          </div>
          <div class="row">
            <div id="sector" class="col-xs-6">
              <h4>Sector (What)</h4>
            </div>
            <div id="status" class="col-xs-6">
              <h4>Priority (What)</h4>
            </div>
          </div>
          <div class="row">
            <div id="orgs" class="col-lg-12">
              <h4>Top Ten Organisations (Who)</h4>
              <div class="col-xs-12">By activity count</div>
           </div>
          </div>
        </div>
        <div id="map" class="col-lg-8">
          <h3>Map (Where)</h3><p><a href="javascript:governoratesMapShow();">Governorates</a> - Regions</p>
        </div>
        <div id="map2" class="col-lg-8">
          <h4>Map (Where)</h4><p>Governorates - <a href="javascript:regionsMapShow();">Regions</a></p>
        </div>
      </div>
     
    </div>
    <a href="https://github.com/simonbjohnson/3W-Dashboard/">Credit</a>
    
    <script type="text/javascript" src="js/d3.js"></script>
    <script type="text/javascript" src="js/crossfilter.js"></script>
    <script type="text/javascript" src="js/dc.js"></script>

    <script>

        function regionsMapShow(){
            $('#map2').hide();
            $('#map').show();
            map2_chart.filterAll();
            dc.redrawAll();
        }

        function governoratesMapShow(){
            $('#map').hide();
            $('#map2').show();
        }
        $('#dashboard').hide();
        $('#map').hide();
        var sector_chart = dc.pieChart("#sector");
        var status_chart = dc.pieChart("#status");
        var map_chart = dc.geoChoroplethChart("#map");
        var org_chart = dc.rowChart("#orgs");
        var map2_chart = dc.geoChoroplethChart("#map2");

        d3.csv("data/3W_Data-jo2.csv", function(csv_data){
            var cf = crossfilter(csv_data);

            cf.sector = cf.dimension(function(d) { return d.SectorJo; });
            cf.status = cf.dimension(function(d) { return d.Status; });
            cf.rcode = cf.dimension(function(d) { return d.RegionCODE; });
            cf.gcode = cf.dimension(function(d) { return d.GovCODE; });
            cf.organisation = cf.dimension(function(d) { return d.Organisation; });

            var sector = cf.sector.group();
            var status = cf.status.group();
            var rcode = cf.rcode.group();
            var organisation = cf.organisation.group();
            var gcode = cf.gcode.group();
            var all = cf.groupAll();
            
           
            console.log(all.value());
            
            
            
             /* 3W data are sorted per sector and color are allocated to sectors */
            sector_chart.width(180).height(180)
                .dimension(cf.sector)
                .group(sector)
                .innerRadius(10)
                .colors(['#fd8d3c',
                        '#fc4e2a',
                        '#e31a1c',
                        '#bd0026',
                        '#800026',
                        '#807dba',
                        '#6a51a3',
                        '#54278f',
                        '#3f007d'])
                .colorDomain([0,8])
                .colorAccessor(function(d, i){return i%9;});

            status_chart.width(180).height(180)
                .dimension(cf.status)
                .group(status)
                .innerRadius(10)
                .colors(['#2ca25f',
                        '#bd0026',
                        '#3182bd',
                        '#ffeda0'
                        ])
                .colorDomain([0,3])
                .colorAccessor(function(d, i){return i%4;});

            org_chart.width(320).height(300)
                .dimension(cf.organisation)
                .group(organisation)
                .elasticX(true)
                .data(function(group) {
                    return group.top(10);
                })
                .colors(['#3182bd'])
                .colorDomain([0,0])
                .colorAccessor(function(d, i){return 1;});

            dc.dataCount("#count-info")
            
        .dimension(cf)
        .group(all);
        
             /* Region map with ID rid */
            d3.json("data/region.geojson", function (regionsJSON) {

                map_chart.width(660).height(600)
                    .dimension(cf.rcode)
                    .group(rcode)
                    .colors(['#AAAAAA', '#CB181D'])
                    .colorDomain([0, 1])
                    .colorAccessor(function (d) {
                        if(d>0){
                            return 1;
                        } else {
                            return 0;
                        }
                    })
                    .overlayGeoJson(regionsJSON.features, "Region", function (d) {
                        return d.properties.rid;
                    })
                    .projection(d3.geo.mercator().center([38,31.5]).scale(6500)) /* Center on Jordan */
                    .title(function (d) {
                        return "Region: " + rcode2reg[d.key];
                    });

             /* Governorate map with ID adm1_code */
                    d3.json("data/admin1.geojson", function (governJSON){
                        map2_chart.width(660).height(600)
                            .dimension(cf.gcode)
                            .group(gcode)
                            .colors(['#AAAAAA', '#CB181D'])
                            .colorDomain([0, 1])
                            .colorAccessor(function (d) {
                                if(d>0){
                                    return 1;
                                } else {
                                    return 0;
                                }
                            })
                            .overlayGeoJson(governJSON.features, "Governorates", function (d) {
                                return d.properties.adm1_code;
                            })
                            .projection(d3.geo.mercator().center([38,31.5]).scale(6500)) /* Center on Jordan */
                            .title(function (d) {
                                return "Governorate: " + gcode2gov[d.key];
                            });
                            $('#loading').hide();
                            $('#dashboard').show();
                            dc.renderAll();

                    });
                });
        });
    </script>
    
    
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.1/js/bootstrap.min.js"></script>
  </body>
</html>
